#include "Player.h"
#include "sfutil.h"

Player::Player(sf::Color c) {
	shape.setFillColor(c);
	shape.setRadius(16.0);
	shape.setOrigin(16.0, 16.0);

	speed = 300.0f;
	cooldown = 0.1f;

	velocity = sf::Vector2f(0, 0);
}

void Player::loop(const sf::Time& dt) {
	move(velocity * dt.asSeconds());
	velocity *= .5f;

	for (auto it = bullets.begin(); it != bullets.end(); it++) {
		it->loop(dt);
	}
	
	auto bullet = bullets.begin();
	while (bullet != bullets.end()) {
		while (bullet != bullets.end() && !bullet->stillAlive()) {
			bullet = bullets.erase(bullet);
		}
		bullet++;
	}
}

void Player::spawnBullet(const sf::Vector2f& velo) {
	static double cd = 0.0;
	if (cd >= cooldown);
	bullets.push_back(Bullet(
				getPosition(),
				sf::Vector2f(velo),
				shape.getFillColor()
				));
}

void Player::draw (
		sf::RenderTarget& target,
		sf::RenderStates states) const {
	for (Bullet it : bullets) {
		target.draw(it, states);
	}
	states.transform *= getTransform();
	target.draw(shape, states);
	//printf("Drawn.\n");
}
